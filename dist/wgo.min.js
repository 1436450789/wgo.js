/*! WGo.js library, MIT license, wgo.waltheri.net */
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.WGo=a.WGo||{})}(this,function(a){"use strict";function b(a){var b=WGo.i18n[WGo.lang][a]||WGo.i18n.en[a];if(b){for(var c=1;c<arguments.length;c++)b=b.replace("$",arguments[c]);return b}return a}var c={};c["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},c.classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},c.createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),c.get=function ha(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){var e=Object.getPrototypeOf(a);return null===e?void 0:ha(e,b,c)}if("value"in d)return d.value;var f=d.get;if(void 0!==f)return f.call(c)},c.inherits=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},c.possibleConstructorReturn=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b};var d=1,e=d,f=-1,g=f,h=0,i=h,j=!1,k="en",l={en:{}},m=function(){function a(b){c.classCallCheck(this,a),this.size=b||19,this.grid=[],this.clear(),this.capCount={black:0,white:0},this.turn=e}return c.createClass(a,[{key:"get",value:function(a,b){return 0>a||0>b||a>=this.size||b>=this.size?void 0:this.grid[a*this.size+b]}},{key:"set",value:function(a,b,c){return this.grid[a*this.size+b]=c,this}},{key:"clear",value:function(){for(var a=0;a<this.size*this.size;a++)this.grid[a]=i;return this}},{key:"clone",value:function b(){var b=new a(this.size);return b.grid=this.grid.slice(0),b.capCount.black=this.capCount.black,b.capCount.white=this.capCount.white,b.turn=this.turn,b}},{key:"compare",value:function(a){for(var b=[],c=[],d=0;d<this.size*this.size;d++)this.grid[d]&&!a.grid[d]?c.push({x:Math.floor(d/this.size),y:d%this.size}):this.grid[d]!=a.grid[d]&&b.push({x:Math.floor(d/this.size),y:d%this.size,c:a.grid[d]});return{add:b,remove:c}}}]),a}(),n=function ia(a,b,c,d,e){c>=0&&c<a.size&&d>=0&&d<a.size&&a.get(c,d)==e&&(a.set(c,d,0),b.push({x:c,y:d}),ia(a,b,c,d-1,e),ia(a,b,c,d+1,e),ia(a,b,c-1,d,e),ia(a,b,c+1,d,e))},o=function ja(a,b,c,d,e){return 0>c||c>=a.size||0>d||d>=a.size?!1:a.get(c,d)==i?!0:1==b.get(c,d)||a.get(c,d)==-e?!1:(b.set(c,d,!0),ja(a,b,c,d-1,e)||ja(a,b,c,d+1,e)||ja(a,b,c-1,d,e)||ja(a,b,c+1,d,e))},p=function(a,b,c,d){var e=[];if(b>=0&&b<a.size&&c>=0&&c<a.size&&a.get(b,c)==d){var f=new m(a.size);o(a,f,b,c,d)||n(a,e,b,c,d)}return e},q=function(a,b,c){var d,e;if("KO"==this.repeating&&this.stack.length-2>=0)e=this.stack.length-2;else{if("ALL"!=this.repeating)return!0;e=0}for(var f=this.stack.length-2;f>=e;f--)if(this.stack[f].get(b,c)==a.get(b,c)){d=!0;for(var g=0;g<this.size*this.size;g++)if(this.stack[f].grid[g]!=a.grid[g]){d=!1;break}if(d)return!1}return!0},r=function(){function a(b,d,e,f){c.classCallCheck(this,a),this.size=b||19,this.repeating=void 0===d?"KO":d,this.allow_rewrite=e||!1,this.allow_suicide=f||!1,this.stack=[new m(this.size)],Object.defineProperty(this,"position",{get:function(){return this.stack[this.stack.length-1]},set:function(a){this.stack[this.stack.length-1]=a}})}return c.createClass(a,[{key:"getPosition",value:function(){return this.stack[this.stack.length-1]}},{key:"play",value:function(b,c,d,f){if(!this.isOnBoard(b,c))return a.MOVE_OUT_OF_BOARD;if(!this.allow_rewrite&&0!=this.position.get(b,c))return a.FIELD_OCCUPIED;var d=d||this.position.turn,g=this.position.clone();g.set(b,c,d);var h=d,i=p(g,b-1,c,-d).concat(p(g,b+1,c,-d),p(g,b,c-1,-d),p(g,b,c+1,-d));if(!i.length){var j=new m(this.size);if(!o(g,j,b,c,d)){if(!this.allow_suicide)return a.MOVE_SUICIDE;h=-d,n(g,i,b,c,d)}}return this.repeating&&!q.call(this,g,b,c)?a.POSITION_REPEATED:f?!1:(g.turn=-d,h==e?g.capCount.black+=i.length:g.capCount.white+=i.length,this.pushPosition(g),i)}},{key:"pass",value:function(a){var a=a||this.position.turn;this.pushPosition(),this.position.turn=-a}},{key:"isValid",value:function(a,b,c){return"number"!=typeof this.play(a,b,c,!0)}},{key:"isOnBoard",value:function(a,b){return a>=0&&b>=0&&a<this.size&&b<this.size}},{key:"addStone",value:function(a,b,c){return this.isOnBoard(a,b)&&this.position.get(a,b)==i?(this.position.set(a,b,c||i),!0):!1}},{key:"removeStone",value:function(a,b){return this.isOnBoard(a,b)&&this.position.get(a,b)!=i?(this.position.set(a,b,i),!0):!1}},{key:"setStone",value:function(a,b,c){return this.isOnBoard(a,b)?(this.position.set(a,b,c||i),!0):!1}},{key:"getStone",value:function(a,b){return this.isOnBoard(a,b)?this.position.get(a,b):null}},{key:"pushPosition",value:function(a){var a=a||this.position.clone();return this.stack.push(a),this}},{key:"popPosition",value:function(){var a;return this.stack.length>0&&(a=this.stack.pop()),a}},{key:"firstPosition",value:function(){return this.stack=[],this.pushPosition(new m(this.size)),this}},{key:"getCaptureCount",value:function(a){return a==e?this.position.capCount.black:this.position.capCount.white}},{key:"validatePosition",value:function(){for(var a,b,c=0,d=0,f=[],g=this.position.clone(),h=0;h<this.size;h++)for(var i=0;i<this.size;i++)a=this.position.get(h,i),a&&(b=f.length,f=f.concat(p(g,h-1,i,-a),p(g,h+1,i,-a),p(g,h,i-1,-a),p(g,h,i+1,-a)),a==e?d+=f.length-b:c+=f.length-b);return this.position.capCount.black+=d,this.position.capCount.white+=c,this.position.grid=g.grid,f}}]),a}();r.MOVE_OUT_OF_BOARD=1,r.FIELD_OCCUPIED=2,r.MOVE_SUICIDE=3,r.POSITION_REPEATED=4;var s="A".charCodeAt(0),t="Z".charCodeAt(0),u=" ".charCodeAt(0),v=function(){function a(b){c.classCallCheck(this,a),this.sgfString=b,this.position=0,this.currentChar=b[0],this.lineNo=1,this.charNo=0}return c.createClass(a,[{key:"next",value:function(a){if(a)this.position++,"\n"==this.sgfString[this.position]?(this.charNo=0,this.lineNo++):this.charNo++;else{for(;this.sgfString.charCodeAt(++this.position)<=u;)"\n"==this.sgfString[this.position]?(this.charNo=0,this.lineNo++):this.charNo++;this.charNo++}return this.currentChar=this.sgfString[this.position]}},{key:"parsePropertyValue",value:function(){for(var a="";"]"!=this.next(!0);){if(!this.currentChar)throw new w("End of SGF inside of property",this);if("\\"==this.currentChar){if(this.next(!0),!this.currentChar)throw new w("End of SGF inside of property",this);if("\n"==this.currentChar)continue}a+=this.currentChar}return a}},{key:"parsePropertyValues",value:function(){var a=[];if("["!=this.currentChar)throw new w("Property must have at least one value enclosed in '[' and ']'",this);do{var b=this.parsePropertyValue();""!=b&&a.push(b)}while("["==this.next());return a}},{key:"parsePropertyIdent",value:function(){for(var a="",b=this.sgfString.charCodeAt(this.position);b>=s&&t>=b;)a+=this.currentChar,this.next(),b=this.sgfString.charCodeAt(this.position);return a}},{key:"parseProperties",value:function(){for(var a,b={};a=this.parsePropertyIdent();)b[a]=this.parsePropertyValues();return b}},{key:"parseNode",value:function(){return this.next(),this.parseProperties()}},{key:"parseSequence",value:function(){var a=[];if(";"!=this.currentChar)throw new w("There must be at least one SGF node in sequence",this);do a.push(this.parseNode());while(";"==this.currentChar);return a}},{key:"parseGameTree",value:function(){this.next();var a=this.parseSequence();return")"!=this.currentChar&&a.push(this.parseCollection()),a}},{key:"parseCollection",value:function(){var a=[];do{if("("!=this.currentChar)throw new w("SGF tree must be enclosed in '(' and ')'",this);a.push(this.parseGameTree()),this.next()}while(this.currentChar&&")"!=this.currentChar);return a}}]),a}(),w=function ka(a,b){c.classCallCheck(this,ka);var d=Error.apply(this);d.name=this.name="SGFSyntaxError",this.message=a||"There was an unspecified syntax error in the SGF",b&&(this.message+=" on line "+b.lineNo+", char "+b.charNo+":\n",this.message+="	"+b.sgfString.split("\n")[b.lineNo-1]+"\n",this.message+="	"+Array(b.charNo+1).join(" ")+"^"),this.stack=d.stack};w.prototype=Object.create(Error.prototype),w.prototype.constructor=w;var x,y=function(a){return{x:a.charCodeAt(0)-97,y:a.charCodeAt(1)-97}},z=function(a){return String.fromCharCode(a.x+97)+String.fromCharCode(a.y+97)},A=function(a,b,c){if(a[b]){var d=a[b].indexOf(z(c));d>=0&&(a[b].splice(d,1),a[b].length||delete a[b])}},B=function la(a,b,c){if(b[c])if(b[c].constructor==Array)b[c].forEach(function(b){la(a,b,0)});else{var d=new K;d.setSGFProperties(b[c]),a.appendChild(d),la(d,b,c+1)}},C=function(a){return function(b,c){if(null==c)b.setMove();else if(c[0]){var d=y(c[0]);d.c=a,b.setMove(d)}else b.setMove({pass:!0,c:a})}},D=function(a,b){return function(c,d){if(null==d){for(var e=Object.keys(c.setup),f=0;f<e.length;f++)c.setup[e[f]]==a&&delete c.setup[e[f]];return void delete c.SGFProperties[b]}c.addSetup(d.map(function(b){var c=y(b);return c.c=a,c}))}},E=function(a){return function(b,c){if(null==c){for(var d=Object.keys(b.markup),e=0;e<d.length;e++)b.markup[d[e]].type==a&&delete b.markup[d[e]];return void delete b.SGFProperties[a]}b.addMarkup(c.map(function(b){var c=y(b);return c.type=a,c}))}},F=function(a,b){return function(c,d){c.gameInfo=c.gameInfo||{},c.gameInfo[a]=c.gameInfo[a]||{},c.gameInfo[a][b]=d.join("")}},G=function(a){return function(b,c){b.gameInfo=b.gameInfo||{},b.gameInfo[a]=c.join("")}},H={B:C(e),W:C(g),AB:D(e,"AB"),AW:D(g,"AW"),AE:D(i,"AE"),PL:function(a,b){b?"b"==b[0]||"B"==b[0]?a.setTurn(e):"w"!=b[0]&&"W"!=b[0]||a.setTurn(g):a.setTurn()},C:function(a,b){a.setComment(b?b.join(""):"")},CR:E("CR"),SQ:E("SQ"),TR:E("TR"),SL:E("SL"),MA:E("MA"),LB:function(a,b){if(null==b){for(var c=Object.keys(a.markup),d=0;d<c.length;d++)"LB"==a.markup[c[d]].type&&delete a.markup[c[d]];return void delete a.SGFProperties.LB}a.addMarkup(b.map(function(a){var b=y(a);return b.type="LB",b.text=a.substr(3),b}))},BR:F("black","rank"),PB:F("black","name"),BT:F("black","team"),WR:F("white","rank"),PW:F("white","name"),WT:F("white","team"),TM:G("basicTime"),OT:G("byoyomi"),AN:G("annotations"),CP:G("copyright"),DT:G("date"),EV:G("event"),GN:G("gameName"),GC:G("gameComment"),ON:G("opening"),PC:G("place"),RE:G("result"),RO:G("round"),RU:G("rules"),SO:G("source"),US:G("user")},I={LB:function(a){return z(a)+":"+a.text}},J=["CR","LB","MA","SL","SQ","TR"],K=function(){function a(){c.classCallCheck(this,a),this.parent=null,this.children=[],this.SGFProperties={},this.gameInfo=null,this.kifuInfo=null,this._init()}return c.createClass(a,null,[{key:"fromJSGF",value:function(b){var c=new a;return c.setSGFProperties(b[0]),B(c,b,1),c}},{key:"fromSGF",value:function(b,c){var d=new v(b);return a.fromJSGF(d.parseCollection()[c||0])}}]),c.createClass(a,[{key:"_init",value:function(){this.setup={},this.markup={},this.move=null,this.comment="",this.turn=null}},{key:"appendChild",value:function(b){if(null==b||!(b instanceof a)||b==this)throw new Error("Invalid argument passed to `appendChild` method, KNode was expected.");return b.parent&&b.parent.removeChild(b),b.parent=this,b.gameInfo=this.gameInfo,b.kifuInfo=this.kifuInfo,this.children.push(b),this}},{key:"cloneNode",value:function(){}},{key:"contains",value:function(a){return this.children.indexOf(a)>=0?!0:this.children.some(function(b){return b.contains(a)})}},{key:"insertBefore",value:function(b,c){if(!(null!=b&&b instanceof a&&b!=this))throw new Error("Invalid argument passed to `insertBefore` method, KNode was expected.");return null==c?this.appendChild(b):(b.parent&&b.parent.removeChild(b),b.parent=this,b.gameInfo=this.gameInfo,b.kifuInfo=this.kifuInfo,this.children.splice(this.children.indexOf(c),0,b),this)}},{key:"removeChild",value:function(a){return this.children.splice(this.children.indexOf(a),1),a.gameInfo=null,a.kifuInfo=null,a.parent=null,this}},{key:"replaceChild",value:function(b,c){if(null==b||!(b instanceof a)||b==this)throw new Error("Invalid argument passed to `replaceChild` method, KNode was expected.");return this.insertBefore(b,c),this.removeChild(c),this}},{key:"setSGFProperty",value:function(a,b){if("string"==typeof b){var c=new v(b);b=c.parsePropertyValues()}return H[a]?H[a](this,b):null==b?delete this.SGFProperties[a]:this.SGFProperties[a]=b,this}},{key:"getSGFProperty",value:function(a){return this.SGFProperties[a]?"["+this.SGFProperties[a].map(function(a){return a.replace(/\]/g,"\\]")}).join("][")+"]":""}},{key:"setSGFProperties",value:function(a){for(var b in a)a.hasOwnProperty(b)&&this.setSGFProperty(b,a[b])}},{key:"setSGF",value:function(b){for(var c=this.children.length-1;c>=0;c--)this.removeChild(this.children[c]);this._init(),this.SGFProperties={};var d="string"==typeof b?new v(b):b;if(this.setSGFProperties(d.parseProperties()),";"==d.currentChar){var e=new a;this.appendChild(e),d.next(),e.setSGF(d)}else if("("==d.currentChar)d.parseCollection().forEach(function(b){this.appendChild(a.fromJSGF(b))}.bind(this));else if(d.currentChar)throw new w("Illegal character in SGF node",d)}},{key:"getSGF",value:function(){var a="";for(var b in this.SGFProperties)this.SGFProperties.hasOwnProperty(b)&&(a+=b+this.getSGFProperty(b));return 1==this.children.length?a+";"+this.children[0].getSGF():this.children.length>1?this.children.reduce(function(a,b){return a+"(;"+b.getSGF()+")"},a):a}},{key:"getSGF",value:function(){var a="";for(var b in this.SGFProperties)this.SGFProperties.hasOwnProperty(b)&&(a+=b+this.getSGFProperty(b));return 1==this.children.length?a+";"+this.children[0].getSGF():this.children.length>1?this.children.reduce(function(a,b){return a+"(;"+b.getSGF()+")"},a):a}},{key:"toSGF",value:function(){return"(;"+this.getSGF()+")"}},{key:"addSetup",value:function(a){a.constructor!=Array&&(a=[a]),this.removeSetup(a);for(var b,c=0;c<a.length;c++)this.setup[a[c].x+":"+a[c].y]=a[c].c,b=a[c].c==e?"AB":a[c].c==g?"AW":"AE",this.SGFProperties[b]||(this.SGFProperties[b]=[]),this.SGFProperties[b].push((I[b]?I[b]:z)(a[c]));return this}},{key:"removeSetup",value:function(a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)delete this.setup[a[b].x+":"+a[b].y],A(this.SGFProperties,"AB",a[b]),A(this.SGFProperties,"AW",a[b]),A(this.SGFProperties,"AE",a[b])}},{key:"addMarkup",value:function(a){a.constructor!=Array&&(a=[a]),this.removeMarkup(a);for(var b=0;b<a.length;b++)this.markup[a[b].x+":"+a[b].y]=a[b],this.SGFProperties[a[b].type]||(this.SGFProperties[a[b].type]=[]),this.SGFProperties[a[b].type].push((I[a[b].type]?I[a[b].type]:z)(a[b]))}},{key:"removeMarkup",value:function(a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++){delete this.markup[a[b].x+":"+a[b].y];for(var c=0;c<J.length;c++)A(this.SGFProperties,J[c],a[b])}}},{key:"setMove",value:function(a){this.move=a,a&&a.c?a.c==g?(delete this.SGFProperties.B,this.SGFProperties.W=[z(a)]):(delete this.SGFProperties.W,this.SGFProperties.B=[z(a)]):(delete this.SGFProperties.B,delete this.SGFProperties.W)}},{key:"setTurn",value:function(a){this.turn=a,a?a==e?this.SGFProperties.PL=["B"]:this.SGFProperties.PL=["W"]:delete this.SGFProperties.PL}},{key:"getTurn",value:function(){return this.turn?this.turn:this.move?-this.move.c:this.parent?this.parent.getTurn():e}},{key:"setComment",value:function(a){this.comment=a,a?this.SGFProperties.C=[a]:delete this.SGFProperties.C}}]),a}(),L=function(a,b){return"function"==typeof b.theme[a]?b.theme[a](b):b.theme[a]},M={old:{shadowColor:"rgba(32,32,32,0.5)",shadowTransparentColor:"rgba(32,32,32,0)",shadowBlur:0,shadowSize:function(a){return a.shadowSize},markupBlackColor:"rgba(255,255,255,0.8)",markupWhiteColor:"rgba(0,0,0,0.8)",markupNoneColor:"rgba(0,0,0,0.8)",markupLinesWidth:function(a){return a.autoLineWidth?a.stoneRadius/7:a.lineWidth},gridLinesWidth:1,gridLinesColor:function(a){return"rgba(0,0,0,"+Math.min(1,a.stoneRadius/15)+")"},starColor:"#000",starSize:function(a){return a.starSize*(a.width/300+1)},stoneSize:function(a){return a.stoneSize*Math.min(a.fieldWidth,a.fieldHeight)/2},coordinatesColor:"rgba(0,0,0,0.7)",font:function(a){return a.font},linesShift:.5},"default":{shadowColor:"rgba(62,32,32,0.5)",shadowTransparentColor:"rgba(62,32,32,0)",shadowBlur:function(a){return.1*a.stoneRadius},shadowSize:1,markupBlackColor:"rgba(255,255,255,0.9)",markupWhiteColor:"rgba(0,0,0,0.7)",markupNoneColor:"rgba(0,0,0,0.7)",markupLinesWidth:function(a){return a.stoneRadius/8},gridLinesWidth:function(a){return a.stoneRadius/15},gridLinesColor:"#654525",starColor:"#531",starSize:function(a){return a.stoneRadius/8+1},stoneSize:function(a){return Math.min(a.fieldWidth,a.fieldHeight)/2},coordinatesColor:"#531",variationColor:"rgba(0,32,128,0.8)",font:"calibri",linesShift:.25}},N=function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.clearRect(c-2*e-b.ls,d-2*e-b.ls,4*e,4*e)},O={draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.beginPath();var f=L("shadowBlur",b),g=Math.max(0,e-.5),h=this.createRadialGradient(c-b.ls,d-b.ls,g-1-f,c-b.ls,d-b.ls,g+f);h.addColorStop(0,L("shadowColor",b)),h.addColorStop(1,L("shadowTransparentColor",b)),this.fillStyle=h,this.arc(c-b.ls,d-b.ls,g+f,0,2*Math.PI,!0),this.fill()},clear:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.clearRect(c-1.1*e-b.ls,d-1.1*e-b.ls,2.2*e,2.2*e)}},P=function(a,b,c){return a.obj_arr[b][c][0].c==e?L("markupBlackColor",a):a.obj_arr[b][c][0].c==g?L("markupWhiteColor",a):L("markupNoneColor",a)},Q=function(a,b,c){return a.obj_arr[b][c][0]&&a.obj_arr[b][c][0].c==g||a.obj_arr[b][c][0].c==e},R=function(a,b){var c;a[b].clear(),a[b].draw(a);for(var d=0;d<a.size;d++)for(var e=0;e<a.size;e++)for(var f=0;f<a.obj_arr[d][e].length;f++){var g=a.obj_arr[d][e][f];c=g.type?"string"==typeof g.type?U[g.type]:g.type:a.stoneHandler,c[b]&&c[b].draw.call(a[b].getContext(g),g,a)}for(var h=0;h<a.obj_list.length;h++){var g=a.obj_list[h],c=g.handler;c[b]&&c[b].draw.call(a[b].getContext(g.args),g.args,a)}},S=function(a,b,c,d,e,f,g,h){a.strokeStyle="rgba(64,64,64,0.2)",a.lineWidth=d/30*h,a.beginPath(),d-=Math.max(1,a.lineWidth);var i,j,b,k,l,m=b+d*Math.cos(e*Math.PI),n=c+d*Math.sin(e*Math.PI),o=b+d*Math.cos(f*Math.PI),p=c+d*Math.sin(f*Math.PI);o>m?(i=(p-n)/(o-m),j=Math.atan(i)):o==m?j=Math.PI/2:(i=(p-n)/(o-m),j=Math.atan(i)-Math.PI);var q=g*d;k=Math.sin(j)*q,l=Math.cos(j)*q;var r=m+k,s=n-l,t=o+k,u=p-l;a.moveTo(m,n),a.bezierCurveTo(r,s,t,u,o,p),a.stroke()},T=function(a){for(var b=a.angle,c=a.angle,d=0;d<a.lines.length;d++)b+=a.lines[d],c-=a.lines[d],S(a.ctx,a.x,a.y,a.radius,b,c,a.factor,a.thickness)},U={NORMAL:{stone:{draw:function(a,b){var c,d=b.getX(a.x),e=b.getY(a.y),f=b.stoneRadius;a.c==g?(c=this.createRadialGradient(d-2*f/5,e-2*f/5,f/3,d-f/5,e-f/5,5*f/5),c.addColorStop(0,"#fff"),c.addColorStop(1,"#aaa")):(c=this.createRadialGradient(d-2*f/5,e-2*f/5,1,d-f/5,e-f/5,4*f/5),c.addColorStop(0,"#666"),c.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=c,this.arc(d-b.ls,e-b.ls,Math.max(0,f-.5),0,2*Math.PI,!0),this.fill()}},shadow:O},PAINTED:{stone:{draw:function(a,b){var c,d=b.getX(a.x),e=b.getY(a.y),f=b.stoneRadius;a.c==g?(c=this.createRadialGradient(d-2*f/5,e-2*f/5,2,d-f/5,e-f/5,4*f/5),c.addColorStop(0,"#fff"),c.addColorStop(1,"#ddd")):(c=this.createRadialGradient(d-2*f/5,e-2*f/5,1,d-f/5,e-f/5,4*f/5),c.addColorStop(0,"#111"),c.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=c,this.arc(d-b.ls,e-b.ls,Math.max(0,f-.5),0,2*Math.PI,!0),this.fill(),this.beginPath(),this.lineWidth=f/6,a.c==g?(this.strokeStyle="#999",this.arc(d+f/8,e+f/8,f/2,0,Math.PI/2,!1)):(this.strokeStyle="#ccc",this.arc(d-f/8,e-f/8,f/2,Math.PI,1.5*Math.PI)),this.stroke()}},shadow:O},GLOW:{stone:{draw:function(a,b){var c,d=b.getX(a.x),e=b.getY(a.y),f=b.stoneRadius;a.c==g?(c=this.createRadialGradient(d-2*f/5,e-2*f/5,f/3,d-f/5,e-f/5,8*f/5),c.addColorStop(0,"#fff"),c.addColorStop(1,"#666")):(c=this.createRadialGradient(d-2*f/5,e-2*f/5,1,d-f/5,e-f/5,3*f/5),c.addColorStop(0,"#555"),c.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=c,this.arc(d-b.ls,e-b.ls,Math.max(0,f-.5),0,2*Math.PI,!0),this.fill()}},shadow:O},SHELL:{stone:{draw:function(a,b){var c,d,e=b.stoneRadius;x=x||Math.ceil(9999999*Math.random()),c=b.getX(a.x),d=b.getY(a.y);var f;if(f=a.c==g?"#aaa":"#000",this.beginPath(),this.fillStyle=f,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill(),a.c==g){var h=x%(3+a.x*b.size+a.y)%3,i=b.size*b.size+a.x*b.size+a.y,j=2/i*(x%i);T(0==h?{ctx:this,x:c,y:d,radius:e,angle:j,lines:[.1,.12,.11,.1,.09,.09,.09,.09],factor:.25,thickness:1.75}:1==h?{ctx:this,x:c,y:d,radius:e,angle:j,lines:[.1,.09,.08,.07,.06,.06,.06,.06,.06,.06,.06],factor:.2,thickness:1.5}:{ctx:this,x:c,y:d,radius:e,angle:j,lines:[.12,.14,.13,.12,.12,.12],factor:.3,thickness:2}),f=this.createRadialGradient(c-2*e/5,d-2*e/5,e/3,c-e/5,d-e/5,5*e/5),f.addColorStop(0,"rgba(255,255,255,0.9)"),f.addColorStop(1,"rgba(255,255,255,0)"),this.beginPath(),this.fillStyle=f,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill()}else f=this.createRadialGradient(c+.4*e,d+.4*e,0,c+.5*e,d+.5*e,e),f.addColorStop(0,"rgba(32,32,32,1)"),f.addColorStop(1,"rgba(0,0,0,0)"),this.beginPath(),this.fillStyle=f,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill(),f=this.createRadialGradient(c-.4*e,d-.4*e,1,c-.5*e,d-.5*e,1.5*e),f.addColorStop(0,"rgba(64,64,64,1)"),f.addColorStop(1,"rgba(0,0,0,0)"),this.beginPath(),this.fillStyle=f,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill()}},shadow:O},MONO:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius,f=L("markupLinesWidth",b)||1;a.c==g?this.fillStyle="white":this.fillStyle="black",this.beginPath(),this.arc(c,d,Math.max(0,e-f),0,2*Math.PI,!0),this.fill(),this.lineWidth=f,this.strokeStyle="black",this.stroke()}}},CR:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||P(b,a.x,a.y),this.lineWidth=a.lineWidth||L("markupLinesWidth",b)||1,this.beginPath(),this.arc(c-b.ls,d-b.ls,e/2,0,2*Math.PI,!0),this.stroke()}}},LB:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius,f=a.font||L("font",b)||"";this.fillStyle=a.c||P(b,a.x,a.y),1==a.text.length?this.font=Math.round(1.5*e)+"px "+f:2==a.text.length?this.font=Math.round(1.2*e)+"px "+f:this.font=Math.round(e)+"px "+f,this.beginPath(),this.textBaseline="middle",this.textAlign="center",this.fillText(a.text,c,d,2*e)}},grid:{draw:function(a,b){if(!Q(b,a.x,a.y)&&!a._nodraw){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.clearRect(c-e,d-e,2*e,2*e)}},clear:function(a,b){Q(b,a.x,a.y)||(a._nodraw=!0,R(b,"grid"),delete a._nodraw)}}},SQ:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=Math.round(b.stoneRadius);this.strokeStyle=a.c||P(b,a.x,a.y),this.lineWidth=a.lineWidth||L("markupLinesWidth",b)||1,this.beginPath(),this.rect(Math.round(c-e/2)-b.ls,Math.round(d-e/2)-b.ls,e,e),this.stroke()}}},TR:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||P(b,a.x,a.y),this.lineWidth=a.lineWidth||L("markupLinesWidth",b)||1,this.beginPath(),this.moveTo(c-b.ls,d-b.ls-Math.round(e/2)),this.lineTo(Math.round(c-e/2)-b.ls,Math.round(d+e/3)+b.ls),this.lineTo(Math.round(c+e/2)+b.ls,Math.round(d+e/3)+b.ls),this.closePath(),this.stroke()}}},MA:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||P(b,a.x,a.y),this.lineCap="round",this.lineWidth=2*(a.lineWidth||L("markupLinesWidth",b)||1)-1,this.beginPath(),this.moveTo(Math.round(c-e/2),Math.round(d-e/2)),this.lineTo(Math.round(c+e/2),Math.round(d+e/2)),this.moveTo(Math.round(c+e/2)-1,Math.round(d-e/2)),this.lineTo(Math.round(c-e/2)-1,Math.round(d+e/2)),this.stroke(),this.lineCap="butt"}}},SL:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.fillStyle=a.c||P(b,a.x,a.y),this.beginPath(),this.rect(c-e/2,d-e/2,e,e),this.fill()}}},SM:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||P(b,a.x,a.y),this.lineWidth=2*(a.lineWidth||L("markupLinesWidth",b)||1),this.beginPath(),this.arc(c-e/3,d-e/3,e/6,0,2*Math.PI,!0),this.stroke(),this.beginPath(),this.arc(c+e/3,d-e/3,e/6,0,2*Math.PI,!0),this.stroke(),this.beginPath(),this.moveTo(c-e/1.5,d),this.bezierCurveTo(c-e/1.5,d+e/2,c+e/1.5,d+e/2,c+e/1.5,d),this.stroke()}}},outline:{stone:{draw:function(a,b){a.alpha?this.globalAlpha=a.alpha:this.globalAlpha=.3,a.stoneStyle?U[a.stoneStyle].stone.draw.call(this,a,b):b.stoneHandler.stone.draw.call(this,a,b),this.globalAlpha=1}}},mini:{stone:{draw:function(a,b){b.stoneRadius=b.stoneRadius/2,a.stoneStyle?U[a.stoneStyle].stone.draw.call(this,a,b):b.stoneHandler.stone.draw.call(this,a,b),b.stoneRadius=2*b.stoneRadius}}}},V=function(){function a(){c.classCallCheck(this,a),this.element=document.createElement("canvas"),this.context=this.element.getContext("2d"),this.pixelRatio=window.devicePixelRatio||1,this.pixelRatio>1&&this.context.scale(this.pixelRatio,this.pixelRatio)}return c.createClass(a,[{key:"setDimensions",value:function(a,b){this.element.width=a,this.element.style.width=a/this.pixelRatio+"px",this.element.height=b,this.element.style.height=b/this.pixelRatio+"px"}},{key:"appendTo",value:function(a,b){this.element.style.position="absolute",this.element.style.zIndex=b,a.appendChild(this.element)}},{key:"removeFrom",value:function(a){a.removeChild(this.element)}},{key:"getContext",value:function(){return this.context}},{key:"draw",value:function(a){}},{key:"clear",value:function(){this.context.clearRect(0,0,this.element.width,this.element.height)}}]),a}(),W=function(a){function b(){return c.classCallCheck(this,b),c.possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this))}return c.inherits(b,a),c.createClass(b,[{key:"draw",value:function(a){var b;this.context.beginPath(),this.context.lineWidth=L("gridLinesWidth",a),this.context.strokeStyle=L("gridLinesColor",a);var c=Math.round(a.left),d=Math.round(a.top),e=Math.round(a.fieldWidth*(a.size-1)),f=Math.round(a.fieldHeight*(a.size-1));this.context.strokeRect(c-a.ls,d-a.ls,e,f);for(var g=1;g<a.size-1;g++)b=Math.round(a.getX(g))-a.ls,this.context.moveTo(b,d),this.context.lineTo(b,d+f),b=Math.round(a.getY(g))-a.ls,this.context.moveTo(c,b),this.context.lineTo(c+e,b);if(this.context.stroke(),this.context.fillStyle=L("starColor",a),a.starPoints[a.size])for(var h in a.starPoints[a.size])this.context.beginPath(),this.context.arc(a.getX(a.starPoints[a.size][h].x)-a.ls,a.getY(a.starPoints[a.size][h].y)-a.ls,L("starSize",a),0,2*Math.PI,!0),this.context.fill()}}]),b}(V),X=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?4:arguments[0];c.classCallCheck(this,b);var d=c.possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return d.init(a),d}return c.inherits(b,a),c.createClass(b,[{key:"init",value:function(a){var b,c;this.layers=a,this.elements=[],this.contexts=[],this.pixelRatio=window.devicePixelRatio||1;for(var d=0;a>d;d++)b=document.createElement("canvas"),c=b.getContext("2d"),this.pixelRatio>1&&c.scale(this.pixelRatio,this.pixelRatio),this.elements.push(b),this.contexts.push(c)}},{key:"appendTo",value:function(a,b){for(var c=0;c<this.layers;c++)this.elements[c].style.position="absolute",this.elements[c].style.zIndex=b,a.appendChild(this.elements[c])}},{key:"removeFrom",value:function(a){for(var b=0;b<this.layers;b++)a.removeChild(this.elements[b])}},{key:"getContext",value:function(a){return a.x%2?a.y%2?this.contexts[0]:this.contexts[1]:a.y%2?this.contexts[2]:this.contexts[3]}},{key:"clear",value:function(a,b){for(var c=0;c<this.layers;c++)this.contexts[c].clearRect(0,0,this.elements[c].width,this.elements[c].height)}},{key:"setDimensions",value:function(a,b){for(var c=0;c<this.layers;c++)this.elements[c].width=a,this.elements[c].style.width=a/this.pixelRatio+"px",this.elements[c].height=b,this.elements[c].style.height=b/this.pixelRatio+"px"}}]),b}(V),Y=function(a){function b(a,d,e){c.classCallCheck(this,b);var f=c.possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this,2));return f.shadowSize=void 0===d?1:d,f.board=a,f}return c.inherits(b,a),c.createClass(b,[{key:"getContext",value:function(a){return!(a.x%2&&a.y%2)&&(a.x%2||a.y%2)?this.contexts[1]:this.contexts[0]}},{key:"setDimensions",value:function(a,d){c.get(Object.getPrototypeOf(b.prototype),"setDimensions",this).call(this,a,d);for(var e=0;e<this.layers;e++)this.contexts[e].setTransform(1,0,0,1,Math.round(this.shadowSize*this.board.stoneRadius/7),Math.round(this.shadowSize*this.board.stoneRadius/7))}}]),b}(X),Z=function(){return 3*this.width/(4*(this.bx+1-this.tx)+2)-this.fieldWidth*this.tx},$=function(){return 3*this.height/(4*(this.by+1-this.ty)+2)-this.fieldHeight*this.ty},_=function(){return 4*this.width/(4*(this.bx+1-this.tx)+2)},aa=function(){return 4*this.height/(4*(this.by+1-this.ty)+2)},ba=function(a,b){for(var c,d=0;d<this.obj_arr[a][b].length;d++){var e=this.obj_arr[a][b][d];c=e.type?"string"==typeof e.type?U[e.type]:e.type:this.stoneHandler;for(var f in c)c[f].clear?c[f].clear.call(this[f].getContext(e),e,this):N.call(this[f].getContext(e),e,this)}},ca=function(a,b){for(var c,d=0;d<this.obj_arr[a][b].length;d++){var e=this.obj_arr[a][b][d];c=e.type?"string"==typeof e.type?U[e.type]:e.type:this.stoneHandler;for(var f in c)c[f].draw.call(this[f].getContext(e),e,this)}},da=function(a){var b,c;return b=a.layerX*this.pixelRatio,b-=this.left,b/=this.fieldWidth,b=Math.round(b),c=a.layerY*this.pixelRatio,c-=this.top,c/=this.fieldHeight,c=Math.round(c),{x:b>=this.size?-1:b,y:c>=this.size?-1:c}},ea=function(){this.element.style.width=this.width/this.pixelRatio+"px",this.element.style.height=this.height/this.pixelRatio+"px",this.stoneRadius=L("stoneSize",this),this.ls=L("linesShift",this);for(var a=0;a<this.layers.length;a++)this.layers[a].setDimensions(this.width,this.height)},fa=function(){function a(b,d){c.classCallCheck(this,a);var d=d||{};for(var e in d)this[e]=d[e];for(var e in ga)void 0===this[e]&&(this[e]=ga[e]);for(var e in M["default"])void 0===this.theme[e]&&(this.theme[e]=M["default"][e]);this.tx=this.section.left,this.ty=this.section.top,this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.init(),b.appendChild(this.element),this.pixelRatio=window.devicePixelRatio||1,this.width&&this.height?this.setDimensions(this.width,this.height):this.width?this.setWidth(this.width):this.height&&this.setHeight(this.height)}return c.createClass(a,[{key:"init",value:function(){this.obj_arr=[];for(var a=0;a<this.size;a++){this.obj_arr[a]=[];for(var b=0;b<this.size;b++)this.obj_arr[a][b]=[]}this.obj_list=[],this.layers=[],this.listeners=[],this.element=document.createElement("div"),this.element.className="wgo-board",this.element.style.position="relative",this.background&&("#"==this.background[0]?this.element.style.backgroundColor=this.background:this.element.style.backgroundImage="url('"+this.background+"')"),this.grid=new W,this.shadow=new Y(this,L("shadowSize",this)),this.stone=new X,this.addLayer(this.grid,100),this.addLayer(this.shadow,200),this.addLayer(this.stone,300)}},{key:"setWidth",value:function(a){this.width=a,this.width*=this.pixelRatio,this.fieldHeight=this.fieldWidth=_.call(this),this.left=Z.call(this),this.height=(this.by-this.ty+1.5)*this.fieldHeight,this.top=$.call(this),ea.call(this),this.redraw()}},{key:"setHeight",value:function(a){this.height=a,this.height*=this.pixelRatio,this.fieldWidth=this.fieldHeight=aa.call(this),this.top=$.call(this),this.width=(this.bx-this.tx+1.5)*this.fieldWidth,this.left=Z.call(this),ea.call(this),this.redraw()}},{key:"setDimensions",value:function(a,b){
this.width=a||parseInt(this.element.style.width,10),this.width*=this.pixelRatio,this.height=b||parseInt(this.element.style.height,10),this.height*=this.pixelRatio,this.fieldWidth=_.call(this),this.fieldHeight=aa.call(this),this.left=Z.call(this),this.top=$.call(this),ea.call(this),this.redraw()}},{key:"getSection",value:function(){return this.section}},{key:"setSection",value:function(a,b,d,e){"object"==("undefined"==typeof a?"undefined":c["typeof"](a))?this.section=a:this.section={top:a,right:b,bottom:d,left:e},this.tx=this.section.left,this.ty=this.section.top,this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.setDimensions()}},{key:"setSize",value:function(a){var a=a||19;if(a!=this.size){this.size=a,this.obj_arr=[];for(var b=0;b<this.size;b++){this.obj_arr[b]=[];for(var c=0;c<this.size;c++)this.obj_arr[b][c]=[]}this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.setDimensions()}}},{key:"redraw",value:function(){try{for(var a=0;a<this.layers.length;a++)this.layers[a].clear(this),this.layers[a].draw(this);for(var a=0;a<this.size;a++)for(var b=0;b<this.size;b++)ca.call(this,a,b);for(var a=0;a<this.obj_list.length;a++){var c=this.obj_list[a],d=c.handler;for(var e in d)d[e].draw.call(this[e].getContext(c.args),c.args,this)}}catch(f){console.log("WGo board failed to render. Error: "+f.message)}}},{key:"getX",value:function(a){return this.left+a*this.fieldWidth}},{key:"getY",value:function(a){return this.top+a*this.fieldHeight}},{key:"addLayer",value:function(a,b){a.appendTo(this.element,b),a.setDimensions(this.width,this.height),this.layers.push(a)}},{key:"removeLayer",value:function(a){var b=this.layers.indexOf(a);b>=0&&(this.layers.splice(b,1),a.removeFrom(this.element))}},{key:"update",value:function(a){var b;if(a.remove&&"all"==a.remove)this.removeAllObjects();else if(a.remove)for(b=0;b<a.remove.length;b++)this.removeObject(a.remove[b]);if(a.add)for(b=0;b<a.add.length;b++)this.addObject(a.add[b])}},{key:"addObject",value:function(a){if(a.constructor!=Array)try{ba.call(this,a.x,a.y);for(var b=this.obj_arr[a.x][a.y],c=0;c<b.length;c++)if(b[c].type==a.type)return b[c]=a,void ca.call(this,a.x,a.y);a.type?b.push(a):b.unshift(a),ca.call(this,a.x,a.y)}catch(d){console.log("WGo board failed to render. Error: "+d.message)}else for(var e=0;e<a.length;e++)this.addObject(a[e])}},{key:"removeObject",value:function(a){if(a.constructor!=Array)try{for(var b,c=0;c<this.obj_arr[a.x][a.y].length;c++)if(this.obj_arr[a.x][a.y][c].type==a.type){b=c;break}if(void 0===b)return;ba.call(this,a.x,a.y),this.obj_arr[a.x][a.y].splice(b,1),ca.call(this,a.x,a.y)}catch(d){console.log("WGo board failed to render. Error: "+d.message)}else for(var e=0;e<a.length;e++)this.removeObject(a[e])}},{key:"removeObjectsAt",value:function(a,b){this.obj_arr[a][b].length&&(ba.call(this,a,b),this.obj_arr[a][b]=[])}},{key:"removeAllObjects",value:function(){this.obj_arr=[];for(var a=0;a<this.size;a++){this.obj_arr[a]=[];for(var b=0;b<this.size;b++)this.obj_arr[a][b]=[]}this.redraw()}},{key:"addCustomObject",value:function(a,b){this.obj_list.push({handler:a,args:b}),this.redraw()}},{key:"removeCustomObject",value:function(a,b){for(var c=0;c<this.obj_list.length;c++){var d=this.obj_list[c];if(d.handler==a&&d.args==b)return this.obj_list.splice(c,1),this.redraw(),!0}return!1}},{key:"addEventListener",value:function(a,b){var c=this,d={type:a,callback:b,handleEvent:function(a){var d=da.call(c,a);b(d.x,d.y,a)}};this.element.addEventListener(a,d,!0),this.listeners.push(d)}},{key:"removeEventListener",value:function(a,b){for(var c=0;c<this.listeners.length;c++){var d=this.listeners[c];if(d.type==a&&d.callback==b)return this.element.removeEventListener(d.type,d,!0),this.listeners.splice(c,1),!0}return!1}}]),a}(),ga={size:19,width:0,height:0,font:"Calibri",lineWidth:1,autoLineWidth:!1,starPoints:{19:[{x:3,y:3},{x:9,y:3},{x:15,y:3},{x:3,y:9},{x:9,y:9},{x:15,y:9},{x:3,y:15},{x:9,y:15},{x:15,y:15}],13:[{x:3,y:3},{x:9,y:3},{x:3,y:9},{x:9,y:9}],9:[{x:4,y:4}]},stoneHandler:U.SHELL,starSize:1,shadowSize:1,stoneSize:1,section:{top:0,right:0,bottom:0,left:0},theme:{}};v.SGFSyntaxError=w,a.Game=r,a.Position=r,a.SGFParser=v,a.KNode=K,a.CanvasBoard=fa,a.B=d,a.BLACK=e,a.W=f,a.WHITE=g,a.E=h,a.EMPTY=i,a.ERROR_REPORT=j,a.lang=k,a.i18n=l,a.t=b});
//# sourceMappingURL=wgo.min.map