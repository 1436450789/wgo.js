/*! WGo.js library, MIT license, wgo.waltheri.net */
!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.WGo=a.WGo||{})}(this,function(a){"use strict";function b(a){var b=WGo.i18n[WGo.lang][a]||WGo.i18n.en[a];if(b){for(var c=1;c<arguments.length;c++)b=b.replace("$",arguments[c]);return b}return a}var c=1,d=c,e=-1,f=e,g=0,h=g,i=!1,j="en",k={en:{}},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},m=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},n=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),o=function sa(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){var e=Object.getPrototypeOf(a);return null===e?void 0:sa(e,b,c)}if("value"in d)return d.value;var f=d.get;if(void 0!==f)return f.call(c)},p=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},q=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},r=function(){function a(b){m(this,a),this.size=b||19,this.grid=[],this.clear(),this.capCount={black:0,white:0},this.turn=d}return n(a,[{key:"get",value:function(a,b){return 0>a||0>b||a>=this.size||b>=this.size?void 0:this.grid[a*this.size+b]}},{key:"set",value:function(a,b,c){return this.grid[a*this.size+b]=c,this}},{key:"clear",value:function(){for(var a=0;a<this.size*this.size;a++)this.grid[a]=h;return this}},{key:"clone",value:function b(){var b=new a(this.size);return b.grid=this.grid.slice(0),b.capCount.black=this.capCount.black,b.capCount.white=this.capCount.white,b.turn=this.turn,b}},{key:"compare",value:function(a){for(var b=[],c=[],d=0;d<this.size*this.size;d++)this.grid[d]&&!a.grid[d]?c.push({x:Math.floor(d/this.size),y:d%this.size}):this.grid[d]!=a.grid[d]&&b.push({x:Math.floor(d/this.size),y:d%this.size,c:a.grid[d]});return{add:b,remove:c}}}]),a}(),s=1,t=2,u=3,v=4,w=function ta(a,b,c,d,e){c>=0&&c<a.size&&d>=0&&d<a.size&&a.get(c,d)==e&&(a.set(c,d,0),b.push({x:c,y:d}),ta(a,b,c,d-1,e),ta(a,b,c,d+1,e),ta(a,b,c-1,d,e),ta(a,b,c+1,d,e))},x=function ua(a,b,c,d,e){return 0>c||c>=a.size||0>d||d>=a.size?!1:a.get(c,d)==h?!0:1==b.get(c,d)||a.get(c,d)==-e?!1:(b.set(c,d,!0),ua(a,b,c,d-1,e)||ua(a,b,c,d+1,e)||ua(a,b,c-1,d,e)||ua(a,b,c+1,d,e))},y=function(a,b,c,d){var e=[];if(b>=0&&b<a.size&&c>=0&&c<a.size&&a.get(b,c)==d){var f=new r(a.size);x(a,f,b,c,d)||w(a,e,b,c,d)}return e},z=function(a,b,c){var d,e;if("KO"==this.repeating&&this.stack.length-2>=0)e=this.stack.length-2;else{if("ALL"!=this.repeating)return!0;e=0}for(var f=this.stack.length-2;f>=e;f--)if(this.stack[f].get(b,c)==a.get(b,c)){d=!0;for(var g=0;g<this.size*this.size;g++)if(this.stack[f].grid[g]!=a.grid[g]){d=!1;break}if(d)return!1}return!0},A=function(){function a(b,c,d,e){m(this,a),this.size=b||19,"object"==("undefined"==typeof c?"undefined":l(c))&&(d=c.allowRewrite,e=c.allowSuicide,c=c.checkRepeat),this.repeating=null==c?"KO":c,this.allow_rewrite=d||!1,this.allow_suicide=e||!1,this.stack=[new r(this.size)]}return n(a,[{key:"play",value:function(a,b,c,e){if(!this.isOnBoard(a,b))return s;if(!this.allow_rewrite&&0!=this.position.get(a,b))return t;var c=c||this.position.turn,f=this.position.clone();f.set(a,b,c);var g=c,h=y(f,a-1,b,-c).concat(y(f,a+1,b,-c),y(f,a,b-1,-c),y(f,a,b+1,-c));if(!h.length){var i=new r(this.size);if(!x(f,i,a,b,c)){if(!this.allow_suicide)return u;g=-c,w(f,h,a,b,c)}}return this.repeating&&!z.call(this,f,a,b)?v:e?!1:(f.turn=-c,g==d?f.capCount.black+=h.length:f.capCount.white+=h.length,this.pushPosition(f),h)}},{key:"pass",value:function(a){var a=a||this.position.turn;this.pushPosition(),this.position.turn=-a}},{key:"isValid",value:function(a,b,c){return"number"!=typeof this.play(a,b,c,!0)}},{key:"isOnBoard",value:function(a,b){return a>=0&&b>=0&&a<this.size&&b<this.size}},{key:"addStone",value:function(a,b,c){return this.isOnBoard(a,b)&&this.position.get(a,b)==h?(this.position.set(a,b,c||h),!0):!1}},{key:"removeStone",value:function(a,b){return this.isOnBoard(a,b)&&this.position.get(a,b)!=h?(this.position.set(a,b,h),!0):!1}},{key:"setStone",value:function(a,b,c){return this.isOnBoard(a,b)?(this.position.set(a,b,c||h),!0):!1}},{key:"getStone",value:function(a,b){return this.isOnBoard(a,b)?this.position.get(a,b):null}},{key:"pushPosition",value:function(a){var a=a||this.position.clone();return this.stack.push(a),this}},{key:"popPosition",value:function(){var a;return this.stack.length>0&&(a=this.stack.pop()),a}},{key:"firstPosition",value:function(){return this.stack=[],this.pushPosition(new r(this.size)),this}},{key:"getCaptureCount",value:function(a){return a==d?this.position.capCount.black:this.position.capCount.white}},{key:"validatePosition",value:function(){for(var a,b,c=0,e=0,f=[],g=this.position.clone(),h=0;h<this.size;h++)for(var i=0;i<this.size;i++)a=this.position.get(h,i),a&&(b=f.length,f=f.concat(y(g,h-1,i,-a),y(g,h+1,i,-a),y(g,h,i-1,-a),y(g,h,i+1,-a)),a==d?e+=f.length-b:c+=f.length-b);return this.position.capCount.black+=e,this.position.capCount.white+=c,this.position.grid=g.grid,f}},{key:"position",get:function(){return this.stack[this.stack.length-1]},set:function(a){this.stack[this.stack.length-1]=a}}]),a}(),B="A".charCodeAt(0),C="Z".charCodeAt(0),D=" ".charCodeAt(0),E=function(){function a(b){m(this,a),this.sgfString=b,this.position=0,this.currentChar=b[0],this.lineNo=1,this.charNo=0}return n(a,[{key:"next",value:function(a){if(a)this.position++,"\n"==this.sgfString[this.position]?(this.charNo=0,this.lineNo++):this.charNo++;else{for(;this.sgfString.charCodeAt(++this.position)<=D;)"\n"==this.sgfString[this.position]?(this.charNo=0,this.lineNo++):this.charNo++;this.charNo++}return this.currentChar=this.sgfString[this.position]}},{key:"parsePropertyValue",value:function(){for(var a="";"]"!=this.next(!0);){if(!this.currentChar)throw new F("End of SGF inside of property",this);if("\\"==this.currentChar){if(this.next(!0),!this.currentChar)throw new F("End of SGF inside of property",this);if("\n"==this.currentChar)continue}a+=this.currentChar}return a}},{key:"parsePropertyValues",value:function(){var a=[];if("["!=this.currentChar)throw new F("Property must have at least one value enclosed in '[' and ']'",this);do{var b=this.parsePropertyValue();""!=b&&a.push(b)}while("["==this.next());return a}},{key:"parsePropertyIdent",value:function(){for(var a="",b=this.sgfString.charCodeAt(this.position);b>=B&&C>=b;)a+=this.currentChar,this.next(),b=this.sgfString.charCodeAt(this.position);return a}},{key:"parseProperties",value:function(){for(var a,b={};a=this.parsePropertyIdent();)b[a]=this.parsePropertyValues();return b}},{key:"parseNode",value:function(){return this.next(),this.parseProperties()}},{key:"parseSequence",value:function(){var a=[];if(";"!=this.currentChar)throw new F("There must be at least one SGF node in sequence",this);do a.push(this.parseNode());while(";"==this.currentChar);return a}},{key:"parseGameTree",value:function(){this.next();var a=this.parseSequence();return")"!=this.currentChar&&a.push(this.parseCollection()),a}},{key:"parseCollection",value:function(){var a=[];do{if("("!=this.currentChar)throw new F("SGF tree must be enclosed in '(' and ')'",this);a.push(this.parseGameTree()),this.next()}while(this.currentChar&&")"!=this.currentChar);return a}}]),a}(),F=function va(a,b){m(this,va);var c=Error.apply(this);c.name=this.name="SGFSyntaxError",this.message=a||"There was an unspecified syntax error in the SGF",b&&(this.message+=" on line "+b.lineNo+", char "+b.charNo+":\n",this.message+="	"+b.sgfString.split("\n")[b.lineNo-1]+"\n",this.message+="	"+Array(b.charNo+1).join(" ")+"^"),this.stack=c.stack};F.prototype=Object.create(Error.prototype),F.prototype.constructor=F;var G,H=function(a){return{x:a.charCodeAt(0)-97,y:a.charCodeAt(1)-97}},I=function(a){return String.fromCharCode(a.x+97)+String.fromCharCode(a.y+97)},J=function(a,b,c){if(a[b]){var d=a[b].indexOf(I(c));d>=0&&(a[b].splice(d,1),a[b].length||delete a[b])}},K=function wa(a,b,c){if(b[c])if(b[c].constructor==Array)b[c].forEach(function(b){wa(a,b,0)});else{var d=new U;d.setSGFProperties(b[c]),a.appendChild(d),wa(d,b,c+1)}},L=function(a){return function(b,c){if(null==c)b.setMove();else if(c[0]){var d=H(c[0]);d.c=a,b.setMove(d)}else b.setMove({pass:!0,c:a})}},M=function(a,b){return function(c,d){if(null==d){for(var e=Object.keys(c.setup),f=0;f<e.length;f++)c.setup[e[f]]==a&&delete c.setup[e[f]];return void delete c.SGFProperties[b]}c.addSetup(d.map(function(b){var c=H(b);return c.c=a,c}))}},N=function(a){return function(b,c){if(null==c){for(var d=Object.keys(b.markup),e=0;e<d.length;e++)b.markup[d[e]].type==a&&delete b.markup[d[e]];return void delete b.SGFProperties[a]}b.addMarkup(c.map(function(b){var c=H(b);return c.type=a,c}))}},O=function(a,b){return function(c,d){c.parent&&console.warn("Adding player information("+a+"."+b+") to non-root node, probably will be ignored."),c.gameInfo=c.gameInfo||{},c.gameInfo[a]=c.gameInfo[a]||{},c.gameInfo[a][b]=d.join("")}},P=function(a){return function(b,c){b.parent&&console.warn("Adding game information("+a+") to non-root node, probably will be ignored."),b.gameInfo=b.gameInfo||{},b.gameInfo[a]=c.join("")}},Q={B:L(d),W:L(f),AB:M(d,"AB"),AW:M(f,"AW"),AE:M(h,"AE"),PL:function(a,b){b?"b"==b[0]||"B"==b[0]?a.setTurn(d):"w"!=b[0]&&"W"!=b[0]||a.setTurn(f):a.setTurn()},C:function(a,b){a.setComment(b?b.join(""):"")},CR:N("CR"),SQ:N("SQ"),TR:N("TR"),SL:N("SL"),MA:N("MA"),LB:function(a,b){if(null==b){for(var c=Object.keys(a.markup),d=0;d<c.length;d++)"LB"==a.markup[c[d]].type&&delete a.markup[c[d]];return void delete a.SGFProperties.LB}a.addMarkup(b.map(function(a){var b=H(a);return b.type="LB",b.text=a.substr(3),b}))},BR:O("black","rank"),PB:O("black","name"),BT:O("black","team"),WR:O("white","rank"),PW:O("white","name"),WT:O("white","team"),TM:P("basicTime"),OT:P("byoyomi"),AN:P("annotations"),CP:P("copyright"),DT:P("date"),EV:P("event"),GN:P("gameName"),GC:P("gameComment"),ON:P("opening"),PC:P("place"),RE:P("result"),RO:P("round"),RU:P("rules"),SO:P("source"),US:P("user")},R={LB:function(a){return I(a)+":"+a.text}},S=["CR","LB","MA","SL","SQ","TR"],T=["DO","IT","KO"],U=function(){function a(){m(this,a),this.parent=null,this.children=[],this.SGFProperties={},this._init()}return n(a,null,[{key:"fromJSGF",value:function(b){var c=new a;return c.setSGFProperties(b[0]),K(c,b,1),c}},{key:"fromSGF",value:function(b,c){var d=new E(b);return a.fromJSGF(d.parseCollection()[c||0])}}]),n(a,[{key:"_init",value:function(){this.setup={},this.markup={},this.move=null,this.comment="",this.turn=null}},{key:"appendChild",value:function(b){if(null==b||!(b instanceof a)||b==this)throw new Error("Invalid argument passed to `appendChild` method, KNode was expected.");return b.parent&&b.parent.removeChild(b),b.parent=this,this.children.push(b),this}},{key:"cloneNode",value:function(){}},{key:"contains",value:function(a){return this.children.indexOf(a)>=0?!0:this.children.some(function(b){return b.contains(a)})}},{key:"insertBefore",value:function(b,c){if(!(null!=b&&b instanceof a&&b!=this))throw new Error("Invalid argument passed to `insertBefore` method, KNode was expected.");return null==c?this.appendChild(b):(b.parent&&b.parent.removeChild(b),b.parent=this,this.children.splice(this.children.indexOf(c),0,b),this)}},{key:"removeChild",value:function(a){return this.children.splice(this.children.indexOf(a),1),a.parent=null,this}},{key:"replaceChild",value:function(b,c){if(null==b||!(b instanceof a)||b==this)throw new Error("Invalid argument passed to `replaceChild` method, KNode was expected.");return this.insertBefore(b,c),this.removeChild(c),this}},{key:"getProperty",value:function(a){if(this.SGFProperties[a]){if(1==this.SGFProperties[a].length)return""==this.SGFProperties[a][0]&&T.indexOf(a)>=0?!0:this.SGFProperties[a][0];if(this.SGFProperties[a].length>1)return this.SGFProperties[a]}return T.indexOf(a)>=0?!1:""}},{key:"setProperty",value:function(a,b){return null==b||b===!1||""==b?delete this.SGFProperties[a]:b.constructor===Array?this.SGFProperties[a]=b.slice(0):b===!0?this.SGFProperties[a]=[""]:this.SGFProperties[a]=[b],!1}},{key:"setSGFProperty",value:function(a,b){if("string"==typeof b){var c=new E(b);b=c.parsePropertyValues()}return Q[a]?Q[a](this,b):null==b?delete this.SGFProperties[a]:this.SGFProperties[a]=b,this}},{key:"getSGFProperty",value:function(a){return this.SGFProperties[a]?"["+this.SGFProperties[a].map(function(a){return a.replace(/\]/g,"\\]")}).join("][")+"]":""}},{key:"setSGFProperties",value:function(a){for(var b in a)a.hasOwnProperty(b)&&this.setSGFProperty(b,a[b])}},{key:"setFromSGF",value:function(b){for(var c=this.children.length-1;c>=0;c--)this.removeChild(this.children[c]);if(this._init(),this.SGFProperties={},this.setSGFProperties(b.parseProperties()),";"==b.currentChar){var d=new a;this.appendChild(d),b.next(),d.setFromSGF(b)}else if("("==b.currentChar)b.parseCollection().forEach(function(b){this.appendChild(a.fromJSGF(b))}.bind(this));else if(b.currentChar)throw new F("Illegal character in SGF node",b)}},{key:"toSGF",value:function(){return"(;"+this.innerSGF+")"}},{key:"addSetup",value:function(a){a.constructor!=Array&&(a=[a]),this.removeSetup(a);for(var b,c=0;c<a.length;c++)this.setup[a[c].x+":"+a[c].y]=a[c].c,b=a[c].c==d?"AB":a[c].c==f?"AW":"AE",this.SGFProperties[b]||(this.SGFProperties[b]=[]),this.SGFProperties[b].push((R[b]?R[b]:I)(a[c]));return this}},{key:"removeSetup",value:function(a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++)delete this.setup[a[b].x+":"+a[b].y],J(this.SGFProperties,"AB",a[b]),J(this.SGFProperties,"AW",a[b]),J(this.SGFProperties,"AE",a[b])}},{key:"addMarkup",value:function(a){a.constructor!=Array&&(a=[a]),this.removeMarkup(a);for(var b=0;b<a.length;b++)this.markup[a[b].x+":"+a[b].y]=a[b],this.SGFProperties[a[b].type]||(this.SGFProperties[a[b].type]=[]),this.SGFProperties[a[b].type].push((R[a[b].type]?R[a[b].type]:I)(a[b]))}},{key:"removeMarkup",value:function(a){a.constructor!=Array&&(a=[a]);for(var b=0;b<a.length;b++){delete this.markup[a[b].x+":"+a[b].y];for(var c=0;c<S.length;c++)J(this.SGFProperties,S[c],a[b])}}},{key:"setMove",value:function(a){this.move=a,a&&a.c?a.c==f?(delete this.SGFProperties.B,this.SGFProperties.W=[I(a)]):(delete this.SGFProperties.W,this.SGFProperties.B=[I(a)]):(delete this.SGFProperties.B,delete this.SGFProperties.W)}},{key:"setTurn",value:function(a){this.turn=a,a?a==d?this.SGFProperties.PL=["B"]:this.SGFProperties.PL=["W"]:delete this.SGFProperties.PL}},{key:"getTurn",value:function(){return this.turn?this.turn:this.move?-this.move.c:this.parent?this.parent.getTurn():d}},{key:"setComment",value:function(a){this.comment=a,a?this.SGFProperties.C=[a]:delete this.SGFProperties.C}},{key:"root",get:function(){for(var a=this;null!=a.parent;)a=a.parent;return a}},{key:"innerSGF",set:function(a){this.setFromSGF(new E(a))},get:function(){var a="";for(var b in this.SGFProperties)this.SGFProperties.hasOwnProperty(b)&&(a+=b+this.getSGFProperty(b));return 1==this.children.length?a+";"+this.children[0].innerSGF:this.children.length>1?this.children.reduce(function(a,b){return a+"(;"+b.innerSGF+")"},a):a}}]),a}(),V=function(a,b){return"function"==typeof b.theme[a]?b.theme[a](b):b.theme[a]},W={old:{shadowColor:"rgba(32,32,32,0.5)",shadowTransparentColor:"rgba(32,32,32,0)",shadowBlur:0,shadowSize:function(a){return a.shadowSize},markupBlackColor:"rgba(255,255,255,0.8)",markupWhiteColor:"rgba(0,0,0,0.8)",markupNoneColor:"rgba(0,0,0,0.8)",markupLinesWidth:function(a){return a.autoLineWidth?a.stoneRadius/7:a.lineWidth},gridLinesWidth:1,gridLinesColor:function(a){return"rgba(0,0,0,"+Math.min(1,a.stoneRadius/15)+")"},starColor:"#000",starSize:function(a){return a.starSize*(a.width/300+1)},stoneSize:function(a){return a.stoneSize*Math.min(a.fieldWidth,a.fieldHeight)/2},coordinatesColor:"rgba(0,0,0,0.7)",font:function(a){return a.font},linesShift:.5},"default":{shadowColor:"rgba(62,32,32,0.5)",shadowTransparentColor:"rgba(62,32,32,0)",shadowBlur:function(a){return.1*a.stoneRadius},shadowSize:1,markupBlackColor:"rgba(255,255,255,0.9)",markupWhiteColor:"rgba(0,0,0,0.7)",markupNoneColor:"rgba(0,0,0,0.7)",markupLinesWidth:function(a){return a.stoneRadius/8},gridLinesWidth:function(a){return a.stoneRadius/15},gridLinesColor:"#654525",starColor:"#531",starSize:function(a){return a.stoneRadius/8+1},stoneSize:function(a){return Math.min(a.fieldWidth,a.fieldHeight)/2},coordinatesColor:"#531",variationColor:"rgba(0,32,128,0.8)",font:"calibri",linesShift:.25}},X=function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.clearRect(c-2*e-b.ls,d-2*e-b.ls,4*e,4*e)},Y={draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.beginPath();var f=V("shadowBlur",b),g=Math.max(0,e-.5),h=this.createRadialGradient(c-b.ls,d-b.ls,g-1-f,c-b.ls,d-b.ls,g+f);h.addColorStop(0,V("shadowColor",b)),h.addColorStop(1,V("shadowTransparentColor",b)),this.fillStyle=h,this.arc(c-b.ls,d-b.ls,g+f,0,2*Math.PI,!0),this.fill()},clear:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.clearRect(c-1.1*e-b.ls,d-1.1*e-b.ls,2.2*e,2.2*e)}},Z=function(a,b,c){return a.obj_arr[b][c][0].c==d?V("markupBlackColor",a):a.obj_arr[b][c][0].c==f?V("markupWhiteColor",a):V("markupNoneColor",a)},$=function(a,b,c){return a.obj_arr[b][c][0]&&a.obj_arr[b][c][0].c==f||a.obj_arr[b][c][0].c==d},_=function(a,b){var c;a[b].clear(),a[b].draw(a);for(var d=0;d<a.size;d++)for(var e=0;e<a.size;e++)for(var f=0;f<a.obj_arr[d][e].length;f++){var g=a.obj_arr[d][e][f];c=g.type?"string"==typeof g.type?ca[g.type]:g.type:a.stoneHandler,c[b]&&c[b].draw.call(a[b].getContext(g),g,a)}for(var h=0;h<a.obj_list.length;h++){var g=a.obj_list[h],c=g.handler;c[b]&&c[b].draw.call(a[b].getContext(g.args),g.args,a)}},aa=function(a,b,c,d,e,f,g,h){a.strokeStyle="rgba(64,64,64,0.2)",a.lineWidth=d/30*h,a.beginPath(),d-=Math.max(1,a.lineWidth);var i,j,b,k,l,m=b+d*Math.cos(e*Math.PI),n=c+d*Math.sin(e*Math.PI),o=b+d*Math.cos(f*Math.PI),p=c+d*Math.sin(f*Math.PI);o>m?(i=(p-n)/(o-m),j=Math.atan(i)):o==m?j=Math.PI/2:(i=(p-n)/(o-m),j=Math.atan(i)-Math.PI);var q=g*d;k=Math.sin(j)*q,l=Math.cos(j)*q;var r=m+k,s=n-l,t=o+k,u=p-l;a.moveTo(m,n),a.bezierCurveTo(r,s,t,u,o,p),a.stroke()},ba=function(a){for(var b=a.angle,c=a.angle,d=0;d<a.lines.length;d++)b+=a.lines[d],c-=a.lines[d],aa(a.ctx,a.x,a.y,a.radius,b,c,a.factor,a.thickness)},ca={NORMAL:{stone:{draw:function(a,b){var c,d=b.getX(a.x),e=b.getY(a.y),g=b.stoneRadius;a.c==f?(c=this.createRadialGradient(d-2*g/5,e-2*g/5,g/3,d-g/5,e-g/5,5*g/5),c.addColorStop(0,"#fff"),c.addColorStop(1,"#aaa")):(c=this.createRadialGradient(d-2*g/5,e-2*g/5,1,d-g/5,e-g/5,4*g/5),c.addColorStop(0,"#666"),c.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=c,this.arc(d-b.ls,e-b.ls,Math.max(0,g-.5),0,2*Math.PI,!0),this.fill()}},shadow:Y},PAINTED:{stone:{draw:function(a,b){var c,d=b.getX(a.x),e=b.getY(a.y),g=b.stoneRadius;a.c==f?(c=this.createRadialGradient(d-2*g/5,e-2*g/5,2,d-g/5,e-g/5,4*g/5),c.addColorStop(0,"#fff"),c.addColorStop(1,"#ddd")):(c=this.createRadialGradient(d-2*g/5,e-2*g/5,1,d-g/5,e-g/5,4*g/5),c.addColorStop(0,"#111"),c.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=c,this.arc(d-b.ls,e-b.ls,Math.max(0,g-.5),0,2*Math.PI,!0),this.fill(),this.beginPath(),this.lineWidth=g/6,a.c==f?(this.strokeStyle="#999",this.arc(d+g/8,e+g/8,g/2,0,Math.PI/2,!1)):(this.strokeStyle="#ccc",this.arc(d-g/8,e-g/8,g/2,Math.PI,1.5*Math.PI)),this.stroke()}},shadow:Y},GLOW:{stone:{draw:function(a,b){var c,d=b.getX(a.x),e=b.getY(a.y),g=b.stoneRadius;a.c==f?(c=this.createRadialGradient(d-2*g/5,e-2*g/5,g/3,d-g/5,e-g/5,8*g/5),c.addColorStop(0,"#fff"),c.addColorStop(1,"#666")):(c=this.createRadialGradient(d-2*g/5,e-2*g/5,1,d-g/5,e-g/5,3*g/5),c.addColorStop(0,"#555"),c.addColorStop(1,"#000")),this.beginPath(),this.fillStyle=c,this.arc(d-b.ls,e-b.ls,Math.max(0,g-.5),0,2*Math.PI,!0),this.fill()}},shadow:Y},SHELL:{stone:{draw:function(a,b){var c,d,e=b.stoneRadius;G=G||Math.ceil(9999999*Math.random()),c=b.getX(a.x),d=b.getY(a.y);var g;if(g=a.c==f?"#aaa":"#000",this.beginPath(),this.fillStyle=g,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill(),a.c==f){var h=G%(3+a.x*b.size+a.y)%3,i=b.size*b.size+a.x*b.size+a.y,j=2/i*(G%i);ba(0==h?{ctx:this,x:c,y:d,radius:e,angle:j,lines:[.1,.12,.11,.1,.09,.09,.09,.09],factor:.25,thickness:1.75}:1==h?{ctx:this,x:c,y:d,radius:e,angle:j,lines:[.1,.09,.08,.07,.06,.06,.06,.06,.06,.06,.06],factor:.2,thickness:1.5}:{ctx:this,x:c,y:d,radius:e,angle:j,lines:[.12,.14,.13,.12,.12,.12],factor:.3,thickness:2}),g=this.createRadialGradient(c-2*e/5,d-2*e/5,e/3,c-e/5,d-e/5,5*e/5),g.addColorStop(0,"rgba(255,255,255,0.9)"),g.addColorStop(1,"rgba(255,255,255,0)"),this.beginPath(),this.fillStyle=g,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill()}else g=this.createRadialGradient(c+.4*e,d+.4*e,0,c+.5*e,d+.5*e,e),g.addColorStop(0,"rgba(32,32,32,1)"),g.addColorStop(1,"rgba(0,0,0,0)"),this.beginPath(),this.fillStyle=g,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill(),g=this.createRadialGradient(c-.4*e,d-.4*e,1,c-.5*e,d-.5*e,1.5*e),g.addColorStop(0,"rgba(64,64,64,1)"),g.addColorStop(1,"rgba(0,0,0,0)"),this.beginPath(),this.fillStyle=g,this.arc(c-b.ls,d-b.ls,Math.max(0,e-.5),0,2*Math.PI,!0),this.fill()}},shadow:Y},MONO:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius,g=V("markupLinesWidth",b)||1;a.c==f?this.fillStyle="white":this.fillStyle="black",this.beginPath(),this.arc(c,d,Math.max(0,e-g),0,2*Math.PI,!0),this.fill(),this.lineWidth=g,this.strokeStyle="black",this.stroke()}}},CR:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||Z(b,a.x,a.y),this.lineWidth=a.lineWidth||V("markupLinesWidth",b)||1,this.beginPath(),this.arc(c-b.ls,d-b.ls,e/2,0,2*Math.PI,!0),this.stroke()}}},LB:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius,f=a.font||V("font",b)||"";this.fillStyle=a.c||Z(b,a.x,a.y),1==a.text.length?this.font=Math.round(1.5*e)+"px "+f:2==a.text.length?this.font=Math.round(1.2*e)+"px "+f:this.font=Math.round(e)+"px "+f,this.beginPath(),this.textBaseline="middle",this.textAlign="center",this.fillText(a.text,c,d,2*e)}},grid:{draw:function(a,b){if(!$(b,a.x,a.y)&&!a._nodraw){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.clearRect(c-e,d-e,2*e,2*e)}},clear:function(a,b){$(b,a.x,a.y)||(a._nodraw=!0,_(b,"grid"),delete a._nodraw)}}},SQ:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=Math.round(b.stoneRadius);this.strokeStyle=a.c||Z(b,a.x,a.y),this.lineWidth=a.lineWidth||V("markupLinesWidth",b)||1,this.beginPath(),this.rect(Math.round(c-e/2)-b.ls,Math.round(d-e/2)-b.ls,e,e),this.stroke()}}},TR:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||Z(b,a.x,a.y),this.lineWidth=a.lineWidth||V("markupLinesWidth",b)||1,this.beginPath(),this.moveTo(c-b.ls,d-b.ls-Math.round(e/2)),this.lineTo(Math.round(c-e/2)-b.ls,Math.round(d+e/3)+b.ls),this.lineTo(Math.round(c+e/2)+b.ls,Math.round(d+e/3)+b.ls),this.closePath(),this.stroke()}}},MA:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||Z(b,a.x,a.y),this.lineCap="round",this.lineWidth=2*(a.lineWidth||V("markupLinesWidth",b)||1)-1,this.beginPath(),this.moveTo(Math.round(c-e/2),Math.round(d-e/2)),this.lineTo(Math.round(c+e/2),Math.round(d+e/2)),this.moveTo(Math.round(c+e/2)-1,Math.round(d-e/2)),this.lineTo(Math.round(c-e/2)-1,Math.round(d+e/2)),this.stroke(),this.lineCap="butt"}}},SL:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.fillStyle=a.c||Z(b,a.x,a.y),this.beginPath(),this.rect(c-e/2,d-e/2,e,e),this.fill()}}},SM:{stone:{draw:function(a,b){var c=b.getX(a.x),d=b.getY(a.y),e=b.stoneRadius;this.strokeStyle=a.c||Z(b,a.x,a.y),this.lineWidth=2*(a.lineWidth||V("markupLinesWidth",b)||1),this.beginPath(),this.arc(c-e/3,d-e/3,e/6,0,2*Math.PI,!0),this.stroke(),this.beginPath(),this.arc(c+e/3,d-e/3,e/6,0,2*Math.PI,!0),this.stroke(),this.beginPath(),this.moveTo(c-e/1.5,d),this.bezierCurveTo(c-e/1.5,d+e/2,c+e/1.5,d+e/2,c+e/1.5,d),this.stroke()}}},outline:{stone:{draw:function(a,b){a.alpha?this.globalAlpha=a.alpha:this.globalAlpha=.3,a.stoneStyle?ca[a.stoneStyle].stone.draw.call(this,a,b):b.stoneHandler.stone.draw.call(this,a,b),this.globalAlpha=1}}},mini:{stone:{draw:function(a,b){b.stoneRadius=b.stoneRadius/2,a.stoneStyle?ca[a.stoneStyle].stone.draw.call(this,a,b):b.stoneHandler.stone.draw.call(this,a,b),b.stoneRadius=2*b.stoneRadius}}}},da=function(){function a(){m(this,a),this.element=document.createElement("canvas"),this.context=this.element.getContext("2d"),this.pixelRatio=window.devicePixelRatio||1,this.pixelRatio>1&&this.context.scale(this.pixelRatio,this.pixelRatio)}return n(a,[{key:"setDimensions",value:function(a,b){this.element.width=a,this.element.style.width=a/this.pixelRatio+"px",this.element.height=b,this.element.style.height=b/this.pixelRatio+"px"}},{key:"appendTo",value:function(a,b){this.element.style.position="absolute",this.element.style.zIndex=b,a.appendChild(this.element)}},{key:"removeFrom",value:function(a){a.removeChild(this.element)}},{key:"getContext",value:function(){return this.context}},{key:"draw",value:function(a){}},{key:"clear",value:function(){this.context.clearRect(0,0,this.element.width,this.element.height)}}]),a}(),ea=function(a){function b(){return m(this,b),q(this,Object.getPrototypeOf(b).call(this))}return p(b,a),n(b,[{key:"draw",value:function(a){var b;this.context.beginPath(),this.context.lineWidth=V("gridLinesWidth",a),this.context.strokeStyle=V("gridLinesColor",a);var c=Math.round(a.left),d=Math.round(a.top),e=Math.round(a.fieldWidth*(a.size-1)),f=Math.round(a.fieldHeight*(a.size-1));this.context.strokeRect(c-a.ls,d-a.ls,e,f);for(var g=1;g<a.size-1;g++)b=Math.round(a.getX(g))-a.ls,this.context.moveTo(b,d),this.context.lineTo(b,d+f),b=Math.round(a.getY(g))-a.ls,this.context.moveTo(c,b),this.context.lineTo(c+e,b);if(this.context.stroke(),this.context.fillStyle=V("starColor",a),a.starPoints[a.size])for(var h in a.starPoints[a.size])this.context.beginPath(),this.context.arc(a.getX(a.starPoints[a.size][h].x)-a.ls,a.getY(a.starPoints[a.size][h].y)-a.ls,V("starSize",a),0,2*Math.PI,!0),this.context.fill()}}]),b}(da),fa=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?4:arguments[0];m(this,b);var c=q(this,Object.getPrototypeOf(b).call(this));return c.init(a),c}return p(b,a),n(b,[{key:"init",value:function(a){var b,c;this.layers=a,this.elements=[],this.contexts=[],this.pixelRatio=window.devicePixelRatio||1;for(var d=0;a>d;d++)b=document.createElement("canvas"),c=b.getContext("2d"),this.pixelRatio>1&&c.scale(this.pixelRatio,this.pixelRatio),this.elements.push(b),this.contexts.push(c)}},{key:"appendTo",value:function(a,b){for(var c=0;c<this.layers;c++)this.elements[c].style.position="absolute",this.elements[c].style.zIndex=b,a.appendChild(this.elements[c])}},{key:"removeFrom",value:function(a){for(var b=0;b<this.layers;b++)a.removeChild(this.elements[b])}},{key:"getContext",value:function(a){return a.x%2?a.y%2?this.contexts[0]:this.contexts[1]:a.y%2?this.contexts[2]:this.contexts[3]}},{key:"clear",value:function(a,b){for(var c=0;c<this.layers;c++)this.contexts[c].clearRect(0,0,this.elements[c].width,this.elements[c].height)}},{key:"setDimensions",value:function(a,b){for(var c=0;c<this.layers;c++)this.elements[c].width=a,this.elements[c].style.width=a/this.pixelRatio+"px",this.elements[c].height=b,this.elements[c].style.height=b/this.pixelRatio+"px"}}]),b}(da),ga=function(a){function b(a,c,d){m(this,b);var e=q(this,Object.getPrototypeOf(b).call(this,2));return e.shadowSize=void 0===c?1:c,e.board=a,e}return p(b,a),n(b,[{key:"getContext",value:function(a){return!(a.x%2&&a.y%2)&&(a.x%2||a.y%2)?this.contexts[1]:this.contexts[0]}},{key:"setDimensions",value:function(a,c){o(Object.getPrototypeOf(b.prototype),"setDimensions",this).call(this,a,c);for(var d=0;d<this.layers;d++)this.contexts[d].setTransform(1,0,0,1,Math.round(this.shadowSize*this.board.stoneRadius/7),Math.round(this.shadowSize*this.board.stoneRadius/7))}}]),b}(fa),ha=function(){return 3*this.width/(4*(this.bx+1-this.tx)+2)-this.fieldWidth*this.tx},ia=function(){return 3*this.height/(4*(this.by+1-this.ty)+2)-this.fieldHeight*this.ty},ja=function(){return 4*this.width/(4*(this.bx+1-this.tx)+2)},ka=function(){return 4*this.height/(4*(this.by+1-this.ty)+2)},la=function(a,b){for(var c,d=0;d<this.obj_arr[a][b].length;d++){var e=this.obj_arr[a][b][d];c=e.type?"string"==typeof e.type?ca[e.type]:e.type:this.stoneHandler;for(var f in c)c[f].clear?c[f].clear.call(this[f].getContext(e),e,this):X.call(this[f].getContext(e),e,this)}},ma=function(a,b){for(var c,d=0;d<this.obj_arr[a][b].length;d++){var e=this.obj_arr[a][b][d];c=e.type?"string"==typeof e.type?ca[e.type]:e.type:this.stoneHandler;for(var f in c)c[f].draw.call(this[f].getContext(e),e,this)}},na=function(a){var b,c;return b=a.layerX*this.pixelRatio,b-=this.left,b/=this.fieldWidth,b=Math.round(b),c=a.layerY*this.pixelRatio,c-=this.top,c/=this.fieldHeight,c=Math.round(c),{x:b>=this.size?-1:b,y:c>=this.size?-1:c}},oa=function(){this.element.style.width=this.width/this.pixelRatio+"px",this.element.style.height=this.height/this.pixelRatio+"px",this.stoneRadius=V("stoneSize",this),this.ls=V("linesShift",this);for(var a=0;a<this.layers.length;a++)this.layers[a].setDimensions(this.width,this.height)},pa=function(){function a(b,c){m(this,a);var c=c||{};for(var d in c)this[d]=c[d];for(var d in qa)void 0===this[d]&&(this[d]=qa[d]);for(var d in W["default"])void 0===this.theme[d]&&(this.theme[d]=W["default"][d]);this.tx=this.section.left,this.ty=this.section.top,this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.init(),b.appendChild(this.element),this.pixelRatio=window.devicePixelRatio||1,this.width&&this.height?this.setDimensions(this.width,this.height):this.width?this.setWidth(this.width):this.height&&this.setHeight(this.height)}return n(a,[{key:"init",value:function(){this.obj_arr=[];for(var a=0;a<this.size;a++){this.obj_arr[a]=[];for(var b=0;b<this.size;b++)this.obj_arr[a][b]=[]}this.obj_list=[],this.layers=[],this.listeners=[],this.element=document.createElement("div"),this.element.className="wgo-board",this.element.style.position="relative",this.background&&("#"==this.background[0]?this.element.style.backgroundColor=this.background:this.element.style.backgroundImage="url('"+this.background+"')"),this.grid=new ea,this.shadow=new ga(this,V("shadowSize",this)),this.stone=new fa,this.addLayer(this.grid,100),this.addLayer(this.shadow,200),this.addLayer(this.stone,300)}},{key:"setWidth",value:function(a){this.width=a,this.width*=this.pixelRatio,this.fieldHeight=this.fieldWidth=ja.call(this),this.left=ha.call(this),this.height=(this.by-this.ty+1.5)*this.fieldHeight,this.top=ia.call(this),oa.call(this),this.redraw()}},{key:"setHeight",value:function(a){this.height=a,this.height*=this.pixelRatio,this.fieldWidth=this.fieldHeight=ka.call(this),this.top=ia.call(this),this.width=(this.bx-this.tx+1.5)*this.fieldWidth,this.left=ha.call(this),oa.call(this),this.redraw()}},{key:"setDimensions",value:function(a,b){this.width=a||parseInt(this.element.style.width,10),this.width*=this.pixelRatio,this.height=b||parseInt(this.element.style.height,10),this.height*=this.pixelRatio,this.fieldWidth=ja.call(this),this.fieldHeight=ka.call(this),
this.left=ha.call(this),this.top=ia.call(this),oa.call(this),this.redraw()}},{key:"getSection",value:function(){return this.section}},{key:"setSection",value:function(a,b,c,d){"object"==("undefined"==typeof a?"undefined":l(a))?this.section=a:this.section={top:a,right:b,bottom:c,left:d},this.tx=this.section.left,this.ty=this.section.top,this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.setDimensions()}},{key:"setSize",value:function(a){var a=a||19;if(a!=this.size){this.size=a,this.obj_arr=[];for(var b=0;b<this.size;b++){this.obj_arr[b]=[];for(var c=0;c<this.size;c++)this.obj_arr[b][c]=[]}this.bx=this.size-1-this.section.right,this.by=this.size-1-this.section.bottom,this.setDimensions()}}},{key:"redraw",value:function(){try{for(var a=0;a<this.layers.length;a++)this.layers[a].clear(this),this.layers[a].draw(this);for(var a=0;a<this.size;a++)for(var b=0;b<this.size;b++)ma.call(this,a,b);for(var a=0;a<this.obj_list.length;a++){var c=this.obj_list[a],d=c.handler;for(var e in d)d[e].draw.call(this[e].getContext(c.args),c.args,this)}}catch(f){console.log("WGo board failed to render. Error: "+f.message)}}},{key:"getX",value:function(a){return this.left+a*this.fieldWidth}},{key:"getY",value:function(a){return this.top+a*this.fieldHeight}},{key:"addLayer",value:function(a,b){a.appendTo(this.element,b),a.setDimensions(this.width,this.height),this.layers.push(a)}},{key:"removeLayer",value:function(a){var b=this.layers.indexOf(a);b>=0&&(this.layers.splice(b,1),a.removeFrom(this.element))}},{key:"update",value:function(a){var b;if(a.remove&&"all"==a.remove)this.removeAllObjects();else if(a.remove)for(b=0;b<a.remove.length;b++)this.removeObject(a.remove[b]);if(a.add)for(b=0;b<a.add.length;b++)this.addObject(a.add[b])}},{key:"addObject",value:function(a){if(a.constructor!=Array)try{la.call(this,a.x,a.y);for(var b=this.obj_arr[a.x][a.y],c=0;c<b.length;c++)if(b[c].type==a.type)return b[c]=a,void ma.call(this,a.x,a.y);a.type?b.push(a):b.unshift(a),ma.call(this,a.x,a.y)}catch(d){console.log("WGo board failed to render. Error: "+d.message)}else for(var e=0;e<a.length;e++)this.addObject(a[e])}},{key:"removeObject",value:function(a){if(a.constructor!=Array)try{for(var b,c=0;c<this.obj_arr[a.x][a.y].length;c++)if(this.obj_arr[a.x][a.y][c].type==a.type){b=c;break}if(void 0===b)return;la.call(this,a.x,a.y),this.obj_arr[a.x][a.y].splice(b,1),ma.call(this,a.x,a.y)}catch(d){console.log("WGo board failed to render. Error: "+d.message)}else for(var e=0;e<a.length;e++)this.removeObject(a[e])}},{key:"removeObjectsAt",value:function(a,b){this.obj_arr[a][b].length&&(la.call(this,a,b),this.obj_arr[a][b]=[])}},{key:"removeAllObjects",value:function(){this.obj_arr=[];for(var a=0;a<this.size;a++){this.obj_arr[a]=[];for(var b=0;b<this.size;b++)this.obj_arr[a][b]=[]}this.redraw()}},{key:"addCustomObject",value:function(a,b){this.obj_list.push({handler:a,args:b}),this.redraw()}},{key:"removeCustomObject",value:function(a,b){for(var c=0;c<this.obj_list.length;c++){var d=this.obj_list[c];if(d.handler==a&&d.args==b)return this.obj_list.splice(c,1),this.redraw(),!0}return!1}},{key:"addEventListener",value:function(a,b){var c=this,d={type:a,callback:b,handleEvent:function(a){var d=na.call(c,a);b(d.x,d.y,a)}};this.element.addEventListener(a,d,!0),this.listeners.push(d)}},{key:"removeEventListener",value:function(a,b){for(var c=0;c<this.listeners.length;c++){var d=this.listeners[c];if(d.type==a&&d.callback==b)return this.element.removeEventListener(d.type,d,!0),this.listeners.splice(c,1),!0}return!1}}]),a}(),qa={size:19,width:0,height:0,font:"Calibri",lineWidth:1,autoLineWidth:!1,starPoints:{19:[{x:3,y:3},{x:9,y:3},{x:15,y:3},{x:3,y:9},{x:9,y:9},{x:15,y:9},{x:3,y:15},{x:9,y:15},{x:15,y:15}],13:[{x:3,y:3},{x:9,y:3},{x:3,y:9},{x:9,y:9}],9:[{x:4,y:4}]},stoneHandler:ca.SHELL,starSize:1,shadowSize:1,stoneSize:1,section:{top:0,right:0,bottom:0,left:0},theme:{}},ra=function(){function a(b){m(this,a),this.rootNode=b?b.root:new U,this.currentNode=b||this.rootNode}return n(a,[{key:"setRules",value:function(a){}},{key:"first",value:function(){}},{key:"previous",value:function(){}},{key:"next",value:function(a){}},{key:"last",value:function(){}},{key:"goTo",value:function(a){}},{key:"blackName",get:function(){return this.rootNode.getProperty("PB")},set:function(a){this.rootNode.setProperty("PB",a)}},{key:"blackRank",get:function(){return this.rootNode.getProperty("BR")},set:function(a){this.rootNode.setProperty("BR",a)}},{key:"blackTeam",get:function(){return this.rootNode.getProperty("BT")},set:function(a){this.rootNode.setProperty("BT",rank)}},{key:"whiteName",get:function(){return this.rootNode.getProperty("PW")},set:function(a){this.rootNode.setProperty("PW",a)}},{key:"whiteRank",get:function(){return this.rootNode.getProperty("WR")},set:function(a){this.rootNode.setProperty("WR",a)}},{key:"whiteTeam",get:function(){return this.rootNode.getProperty("WT")},set:function(a){this.rootNode.setProperty("WT",rank)}}]),a}();E.SGFSyntaxError=F,a.Game=A,a.Position=A,a.SGFParser=E,a.KNode=U,a.CanvasBoard=pa,a.Kifu=ra,a.B=c,a.BLACK=d,a.W=e,a.WHITE=f,a.E=g,a.EMPTY=h,a.ERROR_REPORT=i,a.lang=j,a.i18n=k,a.t=b,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=wgo.min.map